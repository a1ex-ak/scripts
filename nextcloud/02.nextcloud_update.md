# *** Обновление Nextcloud ***

----------------------------------------------------------------
:ballot_box_with_check: "запуск команды в терминале из корневой деректории"
```yaml
sudo -u www-data php /var/www/nextcloud/updater/updater.phar --no-interaction
```
---------------------------------------------------------------
:ballot_box_with_check: "если права не работают от www-data"
```yaml
sudo -u root php /var/www/nextcloud/updater/updater.phar --no-interaction
```
---------------------------------------------------------------
:ballot_box_with_check: если засралось обновление и ничего не происходит
```yaml
sudo -u www-data php /var/www/nextcloud/occ maintenance:repair
```
---------------------------------------------------------------
:ballot_box_with_check: если выпадает сообщение:
```yaml
        ✘] Check for expected files failed
           The following extra files have been found:
            package-lock.json
            package.json
            composer.json
            composer.lock
```
:ballot_box_with_check: Удаляем эти файлы из --> /var/www/nextcloud/

---------------------------------------------------------------
:ballot_box_with_check: "если после обновления сервер уйшел в режим обслуживания"
    ->> "Config is set to be read-only via option "config_is_read_only""
    --> "для его возвращения редактируем
```yaml
sudo nano /var/www/nextcloud/config/config.php
```
:ballot_box_with_check: меняем значение

`'config_is_read_only' => true,` на `'config_is_read_only' => false,`
`'maintenance' => true,` на `'maintenance' => false,`

--------------------------------------------------------------
# 2. Открываем nextcloud и продолжаем обновление из WEB
   
--------------------------------------------------------------
:ballot_box_with_check: "меняем владельца /var/www/nextcloud/"
```yaml
sudo chown -R www-data:www-data /var/www/nextcloud/
```
--------------------------------------------------------------
# 3. Проверяем работу cron
```yaml
sudo crontab -e -u www-data
```   
проверяем в конце, не забыть про перенос на новую строку в конце --> `*/5  *  *  *  * php -f /var/www/nextcloud/cron.php`
